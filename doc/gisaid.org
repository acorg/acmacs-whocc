#+STARTUP: showall
Time-stamp: <2018-08-30 16:17:42 eu>
* visit [[https://platform.gisaid.org/epi3/start][gisaid]] and login
* Hold Cmd and click A and B in the Type.
* COLLECTION date: at least 1.5 years ago till 1 Feb next year (but gisaid does not allow downloading more than 20k sequences)
* _Leave originating lab empty!_
* Select **Submitting lab** them all using Cmd

   (Change height of the submitting lab <select> 500px)

        [Australia, North Melbourne] WHO CC ...
        [United Kingdom, London] National Institute for Medical Research
        [United Kingdom, London] Crick
        [United states, Atlanta] CDC
        ? [China, Bejing] WHO Chinese National Influenza Center

** Required segments: HA (checkbox to the left from HA)
** Click Search. Total must not exceed 20k isolates (gisaid does not allow downloading more)
** Click leftmost checkbox in header to select all
** Click Download
** Format: Sequences (DNA) as FASTA (second radio button)
** DNA: HA (checkbox to the left from HA)
** FASTA Header: Isolate name |  Collection date | Passage details/history |  Sample ID by submitting lab | Submitting lab | Type |  Lineage
** Date format: YYYY-MM-DD
** Click download
** Check for incorrect duplicates and perhaps fix them
ad gisaid-fasta-merge /d/gisaid_epiflu_sequence.fasta >/dev/null
** make seqdb from newly downloaded fasta file only just to check file content and hidb matching
ad seqdb-create --no-save --db /d/seqdb.json.xz --match-hidb --clades --report-not-aligned-prefixes 32 --save-not-found-locations /d/not-found.txt /d/gisaid_epiflu_sequence.fasta; if [ -f ~/tmp/not-found.txt ]; then echo; echo 'WARNING: *** Not matched ***'; cat ~/tmp/not-found.txt; fi
check and fix wrong names

(progn
  (query-replace-regexp "\\(/201[78]\\)([^)]+)" "\\1" nil (point-min)(point-max))
  (replace-string "bvr-1b (b/phuket/3073/2013)" "B/PHUKET/3073/2013 BVR-1B" nil (point-min)(point-max))
  (replace-string "a/manitoba/rv27522017" "A/MANITOBA/RV2752/2017" nil (point-min)(point-max))
  (replace-string "b/brisbane/62/20117" "B/BRISBANE/62/2017" nil (point-min)(point-max))
  (replace-string "a/macau/601328/20178" "A/MACAU/601328/2018" nil (point-min)(point-max))
  (replace-string "a/south africa/r07338/018" "A/SOUTH AFRICA/R07338/2018" nil (point-min)(point-max))
)

** Install file: ~/AD/sources/ssm-report/bin/gisaid-fasta-install (just run it without arguments)


* ---- local vars
# ======================================================================
### Local Variables:
### eval: (add-hook 'before-save-hook 'time-stamp)
### End:
